---
title: "Activity Budgets"
output: html_document
---

```{r}
library(lme4)
library(tidyr)
library(ggplot2)
install.packages("pillar")
install.packages('Rcpp', dependencies = TRUE)
library(dplyr)

remove.packages("rlang")
install.packages("rlang")
library(rlang)
library(dplyr)
```

## Activity Budgets PRE RELEASE
### Behavior Categories
*Focal Dataset*
```{r}
pre_focals_budget<- pre_focals %>%
  gather("Obs", "behavior", 22:23, na.rm = T) %>% #gathering the two behavior columns
  filter(!behavior %in% c("AL","BL","PO")) %>% #removing these from the behavior column becuase they're mistakes
  mutate(behavior.category = #creating new column for behavior categories
           case_when(behavior %in% c("G+","G-","PR-","PR+","C","CL","N","NU","SU","PL","MA","MO","A+","A-","TH+","TH-","MP+","MP-") ~ as.character("Social"),
                     behavior %in% c("F","FE","FO") ~ as.character("Feeding"),
                     behavior == "L" ~ as.character("Locomote"),
                     behavior %in% c("V","PA") ~ as.character("Predator"),
                     behavior %in% c("YA","SC","SG","SM","PC") ~ as.character("Stress"),
                     behavior %in% c("O","OS","R","PH","AH")~ as.character("Other")))
unique(pre_focals_budget$behavior.category)
```

### Mean Activity Budget Per Hour
```{r}
#Pops
Pops_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "PO") %>% #filter out Pops
  group_by(MONTH,day,hour,behavior.category) %>% #group by these columns because I need unique counts PER HOUR
  summarize(count=n()) %>% #counts up all of the times the behavior in that category was recorded (this is per focal minute)
  mutate(ID = "PO")
Pops_budget

Pops_budget2<- Pops_budget %>%
  group_by(behavior.category) %>% #group by each behavior category
  summarize(total= sum(count)) %>% #this creates a new column called "total" that is the sum of the count column 
  mutate(Occurrences = #new column called "occurrrences"
           case_when(behavior.category == "Feeding" ~ as.numeric(67), #these numbers are the number of times each category was listed in the dataframe up above (Pops_budget). I have to find these because not ever behavior category has the same number of hours it was recorded in, I need to find the unique number for each category. I found these numbers using table(Pops_budget$behavior.category) in the console
                     behavior.category == "Locomote" ~ as.numeric(75),
                     behavior.category == "Other" ~ as.numeric(71),
                     behavior.category == "Predator" ~ as.numeric(154),
                     behavior.category == "Social" ~ as.numeric(45),
                     behavior.category == "Stress" ~ as.numeric(39))) %>%
  mutate(Mean = (total/Occurrences)) #new column called "mean" which is the total sum of each behavior category divided by the number of hours it is recorded in (i.e the occurrences column)
Pops_budget2$total<- NULL
Pops_budget2$Occurrences<- NULL

#Blue
Blue_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "BL") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n()) %>%
  mutate(ID = "BL")

Blue_budget2<- Blue_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(101),
                     behavior.category == "Locomote" ~ as.numeric(76),
                     behavior.category == "Other" ~ as.numeric(87),
                     behavior.category == "Predator" ~ as.numeric(139),
                     behavior.category == "Social" ~ as.numeric(81),
                     behavior.category == "Stress" ~ as.numeric(17))) %>%
  mutate(Mean = (total/Occurrences))
Blue_budget2$total<- NULL
Blue_budget2$Occurrences<- NULL

#Amy
Amy_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "AM") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n()) %>%
  mutate(ID = "AM")

Amy_budget2<- Amy_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(103),
                     behavior.category == "Locomote" ~ as.numeric(88),
                     behavior.category == "Other" ~ as.numeric(68),
                     behavior.category == "Predator" ~ as.numeric(139),
                     behavior.category == "Social" ~ as.numeric(86),
                     behavior.category == "Stress" ~ as.numeric(26))) %>%
  mutate(Mean = (total/Occurrences))
Amy_budget2$total<- NULL
Amy_budget2$Occurrences<- NULL

#Alex
Alex_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "AL") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Alex_budget2<- Alex_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(96),
                     behavior.category == "Locomote" ~ as.numeric(82),
                     behavior.category == "Other" ~ as.numeric(80),
                     behavior.category == "Predator" ~ as.numeric(140),
                     behavior.category == "Social" ~ as.numeric(86),
                     behavior.category == "Stress" ~ as.numeric(33))) %>%
  mutate(Mean = (total/Occurrences))
Alex_budget2$total<- NULL
Alex_budget2$Occurrences<- NULL

#Boo
Boo_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "BO") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Boo_budget2<- Boo_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(100),
                     behavior.category == "Locomote" ~ as.numeric(86),
                     behavior.category == "Other" ~ as.numeric(80),
                     behavior.category == "Predator" ~ as.numeric(133),
                     behavior.category == "Social" ~ as.numeric(81),
                     behavior.category == "Stress" ~ as.numeric(22))) %>%
  mutate(Mean = (total/Occurrences))
Boo_budget2$total<- NULL
Boo_budget2$Occurrences<- NULL

#Big Mama
Bgm_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "BM") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Bgm_budget2<- Bgm_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(92),
                     behavior.category == "Locomote" ~ as.numeric(89),
                     behavior.category == "Other" ~ as.numeric(85),
                     behavior.category == "Predator" ~ as.numeric(151),
                     behavior.category == "Social" ~ as.numeric(78),
                     behavior.category == "Stress" ~ as.numeric(25))) %>%
  mutate(Mean = (total/Occurrences))
Bgm_budget2$total<- NULL
Bgm_budget2$Occurrences<- NULL

#Augustine
Aug_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "AU") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Aug_budget2<- Aug_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(99),
                     behavior.category == "Locomote" ~ as.numeric(93),
                     behavior.category == "Other" ~ as.numeric(95),
                     behavior.category == "Predator" ~ as.numeric(144),
                     behavior.category == "Social" ~ as.numeric(72),
                     behavior.category == "Stress" ~ as.numeric(30))) %>%
  mutate(Mean = (total/Occurrences))
Aug_budget2$total<- NULL
Aug_budget2$Occurrences<- NULL

#Bart
Bart_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "BA") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Bart_budget2<- Bart_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(107),
                     behavior.category == "Locomote" ~ as.numeric(84),
                     behavior.category == "Other" ~ as.numeric(85),
                     behavior.category == "Predator" ~ as.numeric(147),
                     behavior.category == "Social" ~ as.numeric(26),
                     behavior.category == "Stress" ~ as.numeric(45))) %>%
  mutate(Mean = (total/Occurrences))
Bart_budget2$total<- NULL
Bart_budget2$Occurrences<- NULL

#Eddy
Ed_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "ED") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Ed_budget2<- Ed_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(117),
                     behavior.category == "Locomote" ~ as.numeric(83),
                     behavior.category == "Other" ~ as.numeric(86),
                     behavior.category == "Predator" ~ as.numeric(146),
                     behavior.category == "Social" ~ as.numeric(90),
                     behavior.category == "Stress" ~ as.numeric(18))) %>%
  mutate(Mean = (total/Occurrences))
Ed_budget2$total<- NULL
Ed_budget2$Occurrences<- NULL

#Jack
Jack_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "JA") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Jack_budget2<- Jack_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(92),
                     behavior.category == "Locomote" ~ as.numeric(89),
                     behavior.category == "Other" ~ as.numeric(97),
                     behavior.category == "Predator" ~ as.numeric(146),
                     behavior.category == "Social" ~ as.numeric(30),
                     behavior.category == "Stress" ~ as.numeric(37))) %>%
  mutate(Mean = (total/Occurrences))
Jack_budget2$total<- NULL
Jack_budget2$Occurrences<- NULL

#Tinker
Tink_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "TI") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Tink_budget2<- Tink_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(105),
                     behavior.category == "Locomote" ~ as.numeric(89),
                     behavior.category == "Other" ~ as.numeric(89),
                     behavior.category == "Predator" ~ as.numeric(145),
                     behavior.category == "Social" ~ as.numeric(69),
                     behavior.category == "Stress" ~ as.numeric(31))) %>%
  mutate(Mean = (total/Occurrences))
Tink_budget2$total<- NULL
Tink_budget2$Occurrences<- NULL

#Kovu
Kovu_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "KO") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Kovu_budget2<- Kovu_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(114),
                     behavior.category == "Locomote" ~ as.numeric(81),
                     behavior.category == "Other" ~ as.numeric(99),
                     behavior.category == "Predator" ~ as.numeric(137),
                     behavior.category == "Social" ~ as.numeric(78),
                     behavior.category == "Stress" ~ as.numeric(25))) %>%
  mutate(Mean = (total/Occurrences))
Kovu_budget2$total<- NULL
Kovu_budget2$Occurrences<- NULL

#Mango
Mango_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "MG") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Mango_budget2<- Mango_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(105),
                     behavior.category == "Locomote" ~ as.numeric(76),
                     behavior.category == "Other" ~ as.numeric(85),
                     behavior.category == "Predator" ~ as.numeric(153),
                     behavior.category == "Social" ~ as.numeric(32),
                     behavior.category == "Stress" ~ as.numeric(37))) %>%
  mutate(Mean = (total/Occurrences))
Mango_budget2$total<- NULL
Mango_budget2$Occurrences<- NULL

#Neville
Nev_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "NE") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Nev_budget2<- Nev_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(236),
                     behavior.category == "Locomote" ~ as.numeric(96),
                     behavior.category == "Other" ~ as.numeric(84),
                     behavior.category == "Predator" ~ as.numeric(154),
                     behavior.category == "Social" ~ as.numeric(61),
                     behavior.category == "Stress" ~ as.numeric(31))) %>%
  mutate(Mean = (total/Occurrences))
Nev_budget2$total<- NULL
Nev_budget2$Occurrences<- NULL

#Toni
Toni_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "TO") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Toni_budget2<- Toni_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(103),
                     behavior.category == "Locomote" ~ as.numeric(77),
                     behavior.category == "Other" ~ as.numeric(90),
                     behavior.category == "Predator" ~ as.numeric(147),
                     behavior.category == "Social" ~ as.numeric(80),
                     behavior.category == "Stress" ~ as.numeric(24))) %>%
  mutate(Mean = (total/Occurrences))
Toni_budget2$total<- NULL
Toni_budget2$Occurrences<- NULL

#May
May_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "MA") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

May_budget2<- May_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(122),
                     behavior.category == "Locomote" ~ as.numeric(93),
                     behavior.category == "Other" ~ as.numeric(90),
                     behavior.category == "Predator" ~ as.numeric(138),
                     behavior.category == "Social" ~ as.numeric(71),
                     behavior.category == "Stress" ~ as.numeric(28))) %>%
  mutate(Mean = (total/Occurrences))
May_budget2$total<- NULL
May_budget2$Occurrences<- NULL

#Zip
Zip_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "ZI") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Zip_budget2<- Zip_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(84),
                     behavior.category == "Locomote" ~ as.numeric(73),
                     behavior.category == "Other" ~ as.numeric(91),
                     behavior.category == "Predator" ~ as.numeric(147),
                     behavior.category == "Social" ~ as.numeric(27),
                     behavior.category == "Stress" ~ as.numeric(36))) %>%
  mutate(Mean = (total/Occurrences))
Zip_budget2$total<- NULL
Zip_budget2$Occurrences<- NULL

#Batman
Bat_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "BT") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Bat_budget2<- Bat_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(59),
                     behavior.category == "Locomote" ~ as.numeric(71),
                     behavior.category == "Other" ~ as.numeric(98),
                     behavior.category == "Predator" ~ as.numeric(149),
                     behavior.category == "Social" ~ as.numeric(23),
                     behavior.category == "Stress" ~ as.numeric(43))) %>%
  mutate(Mean = (total/Occurrences))
Bat_budget2$total<- NULL
Bat_budget2$Occurrences<- NULL
```

*Troop Mean Activity Budgets*
```{r}
pre_fullbudget<- Pops_budget2 %>%
  full_join(Blue_budget2,by= "behavior.category") %>%
  full_join(Amy_budget2,by= "behavior.category") %>%
  full_join(Alex_budget2,by= "behavior.category") %>%
  full_join(Boo_budget2,by= "behavior.category") %>%
  full_join(Bgm_budget2,by= "behavior.category") %>%
  full_join(Aug_budget2,by= "behavior.category") %>%
  full_join(Ed_budget2,by= "behavior.category") %>%
  full_join(Jack_budget2,by= "behavior.category") %>%
  full_join(Tink_budget2,by= "behavior.category") %>%
  full_join(Kovu_budget2,by= "behavior.category") %>%
  full_join(Mango_budget2,by= "behavior.category") %>%
  full_join(May_budget2,by= "behavior.category") %>%
  full_join(Toni_budget2,by= "behavior.category") %>%
  full_join(Nev_budget2,by= "behavior.category") %>%
  rowwise() %>% #this allows us to work with row-wise dataframe where we want to look at each row individually
  mutate(TroopMean = ((sum(c_across(2:16),na.rm=T))/15), #adding up all the means per category and dividing by 17 monkeys to get average
        release = "pre") #adding column to identify pre-release

pre_fullbudget_reduced<- pre_fullbudget[,c("behavior.category","TroopMean","release")] #these are the only columns I want to look at now
pre_fullbudget_reduced

#A different table for this:
pre_fullbudget_FULL<- bind_rows(Pops_budget2,Blue_budget2,Amy_budget2,Alex_budget2,Boo_budget2,Bgm_budget2,Aug_budget2,Ed_budget2,Jack_budget2,Tink_budget2,Kovu_budget2,Mango_budget2,May_budget2,Toni_budget2,Nev_budget2)
```

### Batman vs Rehabilitant Males: Activity Budget 
```{r}
#Batman
Bat_budget<- pre_focals_budget %>%
  filter(FOCAL.ID == "BT") %>%
  group_by(focal.reference,behavior.category) %>%
  summarize(count=n())
Bat_budget

Bat_budget<- Bat_budget %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/(n_distinct(Bat_budget$focal.reference))))
Bat_budget$total<- NULL

Pops_budget_pred<- Pops_budget %>%
  filter(behavior.category == "Predator") %>%
  mutate(ID = "Pops")
Pops_budget_pred

Bat_budget_pred<- Bat_budget %>%
  filter(behavior.category == "Predator") %>%
  mutate(ID = "Batman")

Males_budget<- bind_rows(Pops_budget_pred, Bat_budget_pred)
Males_budget %>% filter(ID == "Pops")
```

### Trying to do Wilcoxon Test with Batman and Pops
```{r}
ggdensity(Males_budget$count)
ggqqplot(Males_budget$count)

ggboxplot(Males_budget, x = "ID", y = "count", 
          color = "ID", palette = c("#00AFBB", "#E7B800"),
          ylab = "count", xlab = "ID")

WT_PopsBat_pred<- wilcox.test(count ~ ID, data = Males_budget, paired = FALSE)
WT_PopsBat_pred
```

## Activity Budgets POST RELEASE
### Behavior Categories
```{r}
post_focals_budget<- post_focals %>%
  gather("Obs", "behavior", 19:20, na.rm = T) %>% #gathering the two behavior columns
  filter(!behavior %in% c("ED","TH","VL")) %>% #removing these from the behavior column becuase they're mistakes
  mutate(behavior.category = #creating new column for behavior categories
           case_when(behavior %in% c("G+","G-","PR-","PR+","C","CL","N","SU","PL","MA","MO","A+","A-","TH+","TH-","MP+","MP-") ~ as.character("Social"),
                     behavior %in% c("F","FE","FO") ~ as.character("Feeding"),
                     behavior %in% c("L") ~ as.character("Locomote"),
                     behavior %in% c("V","PA") ~ as.character("Predator"),
                     behavior %in% c("YA","SC","SG","SM","PC") ~ as.character("Stress"),
                     behavior %in% c("O","OS","oS","R","PH","AH")~ as.character("Other"))) %>%
  rename(focal.reference = FOCAL.REFERENCE.CODE,
         day = DAY,
        hour = TIME..HOUR.)
unique(post_focals_budget$behavior.category)
```

### Mean Activity Budget Per Focal
```{r}
#Pops
Pops_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "PO") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n()) %>%
  mutate(ID = "PO")

Pops_budget4<- Pops_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(64),
                     behavior.category == "Locomote" ~ as.numeric(59),
                     behavior.category == "Other" ~ as.numeric(48),
                     behavior.category == "Predator" ~ as.numeric(87),
                     behavior.category == "Social" ~ as.numeric(6),
                     behavior.category == "Stress" ~ as.numeric(14))) %>%
  mutate(Mean = (total/Occurrences))
Pops_budget4$total<- NULL
Pops_budget4$Occurrences<- NULL

#Blue
Blue_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "BL") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n()) %>%
  mutate(ID = "BL")

Blue_budget4<- Blue_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(58),
                     behavior.category == "Locomote" ~ as.numeric(59),
                     behavior.category == "Other" ~ as.numeric(47),
                     behavior.category == "Predator" ~ as.numeric(73),
                     behavior.category == "Social" ~ as.numeric(12),
                     behavior.category == "Stress" ~ as.numeric(8))) %>%
  mutate(Mean = (total/Occurrences))
Blue_budget4$total<- NULL
Blue_budget4$Occurrences<- NULL

#Amy
Amy_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "AM") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n()) %>%
  mutate(ID = "AM")

Amy_budget4<- Amy_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(66),
                     behavior.category == "Locomote" ~ as.numeric(58),
                     behavior.category == "Other" ~ as.numeric(40),
                     behavior.category == "Predator" ~ as.numeric(67),
                     behavior.category == "Social" ~ as.numeric(12),
                     behavior.category == "Stress" ~ as.numeric(12))) %>%
  mutate(Mean = (total/Occurrences))
Amy_budget4$total<- NULL
Amy_budget4$Occurrences<- NULL

#Alex
Alex_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "AL") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Alex_budget4<- Alex_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(62),
                     behavior.category == "Locomote" ~ as.numeric(60),
                     behavior.category == "Other" ~ as.numeric(46),
                     behavior.category == "Predator" ~ as.numeric(75),
                     behavior.category == "Social" ~ as.numeric(15),
                     behavior.category == "Stress" ~ as.numeric(14))) %>%
  mutate(Mean = (total/Occurrences))
Alex_budget4$total<- NULL
Alex_budget4$Occurrences<- NULL

#Boo
Boo_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "BO") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Boo_budget4<- Boo_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(47),
                     behavior.category == "Locomote" ~ as.numeric(42),
                     behavior.category == "Other" ~ as.numeric(30),
                     behavior.category == "Predator" ~ as.numeric(49),
                     behavior.category == "Social" ~ as.numeric(8),
                     behavior.category == "Stress" ~ as.numeric(14))) %>%
  mutate(Mean = (total/Occurrences))
Boo_budget4$total<- NULL
Boo_budget4$Occurrences<- NULL

#Big Mama
Bgm_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "BM") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Bgm_budget4<- Bgm_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(53),
                     behavior.category == "Locomote" ~ as.numeric(51),
                     behavior.category == "Other" ~ as.numeric(36),
                     behavior.category == "Predator" ~ as.numeric(58),
                     behavior.category == "Social" ~ as.numeric(5),
                     behavior.category == "Stress" ~ as.numeric(7))) %>%
  mutate(Mean = (total/Occurrences))
Bgm_budget4$total<- NULL
Bgm_budget4$Occurrences<- NULL

#Augustine
Aug_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "AU") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Aug_budget4<- Aug_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(56),
                     behavior.category == "Locomote" ~ as.numeric(49),
                     behavior.category == "Other" ~ as.numeric(49),
                     behavior.category == "Predator" ~ as.numeric(66),
                     behavior.category == "Social" ~ as.numeric(14),
                     behavior.category == "Stress" ~ as.numeric(13))) %>%
  mutate(Mean = (total/Occurrences))
Aug_budget4$total<- NULL
Aug_budget4$Occurrences<- NULL

#Eddy
Ed_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "ED") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Ed_budget4<- Ed_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(52),
                     behavior.category == "Locomote" ~ as.numeric(54),
                     behavior.category == "Other" ~ as.numeric(36),
                     behavior.category == "Predator" ~ as.numeric(61),
                     behavior.category == "Social" ~ as.numeric(19),
                     behavior.category == "Stress" ~ as.numeric(16))) %>%
  mutate(Mean = (total/Occurrences))
Ed_budget4$total<- NULL
Ed_budget4$Occurrences<- NULL

#Jack
Jack_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "JA") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Jack_budget4<- Jack_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(16),
                     behavior.category == "Locomote" ~ as.numeric(20),
                     behavior.category == "Other" ~ as.numeric(17),
                     behavior.category == "Predator" ~ as.numeric(22),
                     behavior.category == "Social" ~ as.numeric(2),
                     behavior.category == "Stress" ~ as.numeric(3))) %>%
  mutate(Mean = (total/Occurrences))
Jack_budget4$total<- NULL
Jack_budget4$Occurrences<- NULL

#Tinker
Tink_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "TI") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Tink_budget4<- Tink_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(41),
                     behavior.category == "Locomote" ~ as.numeric(37),
                     behavior.category == "Other" ~ as.numeric(33),
                     behavior.category == "Predator" ~ as.numeric(43),
                     behavior.category == "Social" ~ as.numeric(9),
                     behavior.category == "Stress" ~ as.numeric(9))) %>%
  mutate(Mean = (total/Occurrences))
Tink_budget4$total<- NULL
Tink_budget4$Occurrences<- NULL

#Kovu
Kovu_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "KO") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Kovu_budget4<- Kovu_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(71),
                     behavior.category == "Locomote" ~ as.numeric(59),
                     behavior.category == "Other" ~ as.numeric(51),
                     behavior.category == "Predator" ~ as.numeric(74),
                     behavior.category == "Social" ~ as.numeric(8),
                     behavior.category == "Stress" ~ as.numeric(20))) %>%
  mutate(Mean = (total/Occurrences))
Kovu_budget4$total<- NULL
Kovu_budget4$Occurrences<- NULL

#Mango
Mango_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "MG") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Mango_budget4<- Mango_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(71),
                     behavior.category == "Locomote" ~ as.numeric(59),
                     behavior.category == "Other" ~ as.numeric(51),
                     behavior.category == "Predator" ~ as.numeric(74),
                     behavior.category == "Social" ~ as.numeric(8),
                     behavior.category == "Stress" ~ as.numeric(20))) %>%
  mutate(Mean = (total/Occurrences))
Mango_budget4$total<- NULL
Mango_budget4$Occurrences<- NULL

#Neville
Nev_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "NE") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Nev_budget4<- Nev_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(35),
                     behavior.category == "Locomote" ~ as.numeric(35),
                     behavior.category == "Other" ~ as.numeric(27),
                     behavior.category == "Predator" ~ as.numeric(39),
                     behavior.category == "Social" ~ as.numeric(0),
                     behavior.category == "Stress" ~ as.numeric(3))) %>%
  mutate(Mean = (total/Occurrences))
Nev_budget4$total<- NULL
Nev_budget4$Occurrences<- NULL

#Toni
Toni_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "TO") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Toni_budget4<- Toni_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(30),
                     behavior.category == "Locomote" ~ as.numeric(26),
                     behavior.category == "Other" ~ as.numeric(23),
                     behavior.category == "Predator" ~ as.numeric(39),
                     behavior.category == "Social" ~ as.numeric(3),
                     behavior.category == "Stress" ~ as.numeric(6))) %>%
  mutate(Mean = (total/Occurrences))
Toni_budget4$total<- NULL
Toni_budget4$Occurrences<- NULL

#May
May_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "MA") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

May_budget4<- May_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(44),
                     behavior.category == "Locomote" ~ as.numeric(42),
                     behavior.category == "Other" ~ as.numeric(35),
                     behavior.category == "Predator" ~ as.numeric(61),
                     behavior.category == "Social" ~ as.numeric(18),
                     behavior.category == "Stress" ~ as.numeric(16))) %>%
  mutate(Mean = (total/Occurrences))
May_budget4$total<- NULL
May_budget4$Occurrences<- NULL

#Zip
Zip_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "ZI") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Zip_budget4<- Zip_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
          case_when(behavior.category == "Feeding" ~ as.numeric(16),
                     behavior.category == "Locomote" ~ as.numeric(20),
                     behavior.category == "Other" ~ as.numeric(17),
                     behavior.category == "Predator" ~ as.numeric(22),
                     behavior.category == "Social" ~ as.numeric(2),
                     behavior.category == "Stress" ~ as.numeric(3))) %>%
  mutate(Mean = (total/Occurrences))
Zip_budget4$total<- NULL
Zip_budget4$Occurrences<- NULL

#Cicero
Cic_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "CI") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Cic_budget4<- Cic_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(8),
                     behavior.category == "Locomote" ~ as.numeric(10),
                     behavior.category == "Other" ~ as.numeric(11),
                     behavior.category == "Predator" ~ as.numeric(14),
                     behavior.category == "Social" ~ as.numeric(2),
                     behavior.category == "Stress" ~ as.numeric(6))) %>%
  mutate(Mean = (total/Occurrences))
Cic_budget4$total<- NULL
Cic_budget4$Occurrences<- NULL

#Homer
Homer_budget3<- post_focals_budget %>%
  filter(FOCAL.ID == "HO") %>%
  group_by(MONTH,day,hour,behavior.category) %>%
  summarize(count=n())

Homer_budget4<- Homer_budget3 %>%
  group_by(behavior.category) %>%
  summarize(total= sum(count)) %>%
  mutate(Occurrences = 
           case_when(behavior.category == "Feeding" ~ as.numeric(15),
                     behavior.category == "Locomote" ~ as.numeric(11),
                     behavior.category == "Other" ~ as.numeric(6),
                     behavior.category == "Predator" ~ as.numeric(16),
                     behavior.category == "Social" ~ as.numeric(0),
                     behavior.category == "Stress" ~ as.numeric(6))) %>%
  mutate(Mean = (total/Occurrences))
Homer_budget4$total<- NULL
Homer_budget4$Occurrences<- NULL
```

*Means for SOCIAL Category*
```{r}
#Pops
Pops_budget_social<- Pops_budget3 %>%
  filter(behavior.category == "Social")
  
Pops_social_mean<- Pops_budget_social %>%
  group_by(behavior.category) %>%
  summarize(total=sum(count)) %>%
  mutate(Mean = total/n_distinct(Pops_budget_social$hour))

#Blue
Blue_budget_social<- Blue_budget3 %>%
  filter(behavior.category == "Social")
  
Blue_social_mean<- Blue_budget_social %>%
  group_by(behavior.category) %>%
  summarize(total=sum(count)) %>%
  mutate(Mean = total/n_distinct(Blue_budget_social$hour))

#Amy
Amy_budget_social<- Amy_budget3 %>%
  filter(behavior.category == "Social")
  
Amy_social_mean<- Amy_budget_social %>%
  group_by(behavior.category) %>%
  summarize(total=sum(count)) %>%
  mutate(Mean = total/n_distinct(Amy_budget_social$hour))

#Alex
Alex_budget_social<- Alex_budget3 %>%
  filter(behavior.category == "Social")
  
Alex_social_mean<- Alex_budget_social %>%
  group_by(behavior.category) %>%
  summarize(total=sum(count)) %>%
  mutate(Mean = total/n_distinct(Alex_budget_social$hour))
```

*Troop Mean Activity Budgets*
```{r}
post_fullbudget<- Pops_budget4 %>%
  full_join(Blue_budget4,by= "behavior.category") %>%
  full_join(Amy_budget4,by= "behavior.category") %>%
  full_join(Alex_budget4,by= "behavior.category") %>%
  full_join(Boo_budget4,by= "behavior.category") %>%
  full_join(Bgm_budget4,by= "behavior.category") %>%
  full_join(Aug_budget4,by= "behavior.category") %>%
  full_join(Ed_budget4,by= "behavior.category") %>%
  full_join(Jack_budget4,by= "behavior.category") %>%
  full_join(Tink_budget4,by= "behavior.category") %>%
  full_join(Kovu_budget4,by= "behavior.category") %>%
  full_join(Mango_budget4,by= "behavior.category") %>%
  full_join(May_budget4,by= "behavior.category") %>%
  full_join(Toni_budget4,by= "behavior.category") %>%
  full_join(Nev_budget4,by= "behavior.category") %>%
  rowwise() %>% #this allows us to work with row-wise dataframe where we want to look at each row individually
  mutate(TroopMean = ((sum(c_across(2:16),na.rm=T))/15), #adding up all the means per category and dividing by 19 monkeys to get average
        release= "post") #adding column to identify pre-release

post_fullbudget_reduced<- post_fullbudget[,c("behavior.category","TroopMean","release")] #these are the only columns I want to look at now
post_fullbudget_reduced

#Different kind of table for this:
post_fullbudget_FULL<- bind_rows(Pops_budget4,Blue_budget4,Amy_budget4,Alex_budget4,Boo_budget4,Bgm_budget4,Aug_budget4,Ed_budget4,Jack_budget4,Tink_budget4,Kovu_budget4,Mango_budget4,May_budget4,Toni_budget4,Nev_budget4)
```

### MEAN Activity Budget Tables and BarChart
```{r}
combined_budget_table<- bind_rows(pre_fullbudget_reduced, post_fullbudget_reduced)
combined_budget_table<- combined_budget_table %>%
  mutate(proportion= TroopMean/60)
combined_budget_table$release= factor(combined_budget_table$release, levels = c("pre", "post"), ordered = TRUE) #reordering the levels so that the bars appear on the barchart in pre-post order

#BarChart
full_budgetplot<- ggplot(data=combined_budget_table, aes(x=behavior.category, y=proportion, fill=release)) +
  geom_bar(position="dodge", stat="identity") +
  scale_fill_discrete(name = "Release Stage", labels = c("Pre", "Post")) +
  scale_y_continuous(labels=scales::percent) +
  theme(axis.text.x = element_text(angle = 45, hjust =1)) + #turning labels on an angle
  labs(x="Behavior Category",y="Mean Percentage Per Hour",fill= "Release Stage") +
  theme(legend.box.background = element_rect(colour = "black")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), #removing gridlines and background 
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  scale_fill_manual(values = c("slategray3","slategray4"))
full_budgetplot

ggsave("Pre&Post Troop AB Plot.pdf", width = 6, height = 4, last_plot())
```
RESULTS: This figure shows the troop's mean percentage of behavior occurrences in each category per hour pre- and post-release.  

## Wilcoxon Tests
### Predator Category
*Setting up Table*
```{r}
pre_fullbudget_pred<- pre_fullbudget %>%
  filter(behavior.category == "Predator") %>%
  t() %>%
  as.data.frame() %>%
  dplyr::slice(2:16) %>%
  rename(Means = V1) %>%
  mutate(release= "pre")
pre_fullbudget_pred

post_fullbudget_pred<- post_fullbudget %>%
  filter(behavior.category == "Predator") %>%
  t() %>%
  as.data.frame() %>%
  dplyr::slice(2:16) %>%
  rename(Means = V1) %>%
  mutate(release= "post")
post_fullbudget_pred

fullbudget_pred<- bind_rows(pre_fullbudget_pred, post_fullbudget_pred)
fullbudget_pred$Means <- as.numeric(as.character((fullbudget_pred$Means)))
```

*Creating boxplots and Paired Data Plots*
```{r}
library(PairedData)
ggdensity(fullbudget_pred$Means)
ggqqplot(fullbudget_pred$Means)

ggboxplot(Males_budget, x = "ID", y = "count", 
          color = "ID", palette = c("#00AFBB", "#E7B800"),
          ylab = "count", xlab = "ID")

group_by(fullbudget_pred, release) %>%
  summarise(
    count = n(),
    median = median(Means, na.rm = TRUE),
    IQR = IQR(Means, na.rm = TRUE)
  )

library(ggpubr)
ggboxplot(fullbudget_pred, x = "release", y = "Means", 
          color = "release", palette = c("slategray4", "slategray4"), fill = "slategray3", legend.position = F,
          order = c("pre", "post"),
          ylab = "Mean Hourly Count", xlab = "Release Stage")

#GGplot2 Plot!
AB_pred_boxplot<- ggplot(fullbudget_pred, aes(x= release, y = Means, fill = release)) +
  geom_boxplot(outlier.color = "black") +
  scale_fill_manual(values = c("skyblue3","skyblue3")) +
  xlab("Release Stage") +
  ylab("Mean Hourly Count") +
  scale_x_discrete(limits=c("pre", "post")) +
  theme_grey(base_size = 13) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  theme(legend.position = "none")

ggsave("Predator Boxplot.pdf", width = 5,height = 4, last_plot())

# Subset weight data before treatment
pre <- subset(fullbudget_pred,  release == "pre", Means,
                 drop = TRUE)
# subset weight data after treatment
post <- subset(fullbudget_pred, release == "post", Means,
                 drop = TRUE)
# Plot paired data
pd <- paired(pre, post)
plot(pd, type = "profile") + theme_bw()
```

*Running Wilcoxon Test*
```{r}
WT_AB_pred<- wilcox.test(Means ~ release, data = fullbudget_pred, paired = TRUE)
WT_AB_pred

wilcox.test(Means ~ release, data = fullbudget_pred, paired = TRUE,
       alternative = "less")
```
RESULTS: The troop's mean hourly display of predator-related behaviors are significantly higher in the pre-release stage than post-release (V=0, p=3.052e-05 ,n=15).

### Social Category
*Setting up Table*
```{r}
pre_fullbudget_social<- pre_fullbudget %>%
  filter(behavior.category == "Social") %>%
  t() %>%
  as.data.frame() %>%
  dplyr::slice(2:16) %>%
  rename(Means = V1) %>%
  mutate(release= "pre")
pre_fullbudget_social

post_fullbudget_social<- post_fullbudget %>%
  filter(behavior.category == "Social") %>%
  t() %>%
  as.data.frame() %>%
  dplyr::slice(2:16) %>%
  rename(Means = V1) %>%
  mutate(release= "post")
post_fullbudget_social

fullbudget_social<- bind_rows(pre_fullbudget_social, post_fullbudget_social)
fullbudget_social$Means <- as.numeric(as.character((fullbudget_social$Means)))
fullbudget_social[30,1]<- as.numeric(0) #this spot has an NA which won't work for wilcoxon test so changing it to 0
```

*Creating boxplots and Paired Data Plots*
```{r}
group_by(fullbudget_social, release) %>%
  summarise(
    count = n(),
    median = median(Means, na.rm = TRUE),
    IQR = IQR(Means, na.rm = TRUE)
  )

ggboxplot(fullbudget_social, x = "release", y = "Means", 
          color = "release", palette = c("#00AFBB", "#E7B800"),
          order = c("pre", "post"),
          ylab = "Mean Hourly Count", xlab = "Release Stage")

#GGplot2 Plot!
AB_social_boxplot<- ggplot(fullbudget_social, aes(x= release, y = Means, fill = release)) +
  geom_boxplot(outlier.color = "black") +
  scale_fill_manual(values = c("coral","coral")) +
  xlab("Release Stage") +
  ylab("Mean Hourly Count") +
  scale_x_discrete(limits=c("pre", "post")) +
  theme_grey(base_size = 13) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  theme(legend.position = "none")

#Saving the plot
ggsave("Social Boxplot.pdf", width = 5, height = 4, last_plot())

# Subset weight data before treatment
pre <- subset(fullbudget_social,  release == "pre", Means,
                 drop = TRUE)
# subset weight data after treatment
post <- subset(fullbudget_social, release == "post", Means,
                 drop = TRUE)
# Plot paired data
pd <- paired(pre, post)
plot(pd, type = "profile") + theme_bw()
```

*Running Wilcoxon Test*
```{r}
WT_AB_social<- wilcox.test(Means ~ release, data = fullbudget_social, paired = TRUE)
WT_AB_social
```
RESUTLS: There is no significant difference in the troop's mean hourly display of social behaviors pre- and post-release

### Stress Category
*Setting up Table*
```{r}
pre_fullbudget_stress<- pre_fullbudget %>%
  filter(behavior.category == "Stress") %>%
  t() %>%
  as.data.frame() %>%
  dplyr::slice(2:16) %>%
  rename(Means = V1) %>%
  mutate(release= "pre")
pre_fullbudget_stress

post_fullbudget_stress<- post_fullbudget %>%
  filter(behavior.category == "Stress") %>%
  t() %>%
  as.data.frame() %>%
  dplyr::slice(2:16) %>%
  rename(Means = V1) %>%
  mutate(release= "post")
post_fullbudget_stress

fullbudget_stress<- bind_rows(pre_fullbudget_stress, post_fullbudget_stress)
fullbudget_stress$Means <- as.numeric(as.character((fullbudget_stress$Means)))
```

*Creating boxplots and Paired Data Plots*
```{r}
#Finding mean/median
group_by(fullbudget_stress, release) %>%
  summarise(
    count = n(),
    median = median(Means, na.rm = TRUE),
    IQR = IQR(Means, na.rm = TRUE)
  )

ggboxplot(fullbudget_stress, x = "release", y = "Means", 
          color = "release", palette = c("#00AFBB", "#E7B800"),
          order = c("pre", "post"),
          ylab = "Mean Hourly Count", xlab = "Release Stage")

#GGplot2 Plot!
AB_stress_boxplot<- ggplot(fullbudget_stress, aes(x= release, y = Means, fill = release)) +
  geom_boxplot(outlier.color = "black") +
  scale_fill_manual(values = c("lightseagreen","lightseagreen")) +
  xlab("Release Stage") +
  ylab("Mean Hourly Count") +
  scale_x_discrete(limits=c("pre", "post")) +
  theme_grey(base_size = 13) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  theme(legend.position = "none")

#Saving the plot
ggsave("Stress Boxplot.pdf", width = 5, height = 4, last_plot())

# Subset weight data before treatment
pre <- subset(fullbudget_stress,  release == "pre", Means,
                 drop = TRUE)
# subset weight data after treatment
post <- subset(fullbudget_stress, release == "post", Means,
                 drop = TRUE)
# Plot paired data
pd <- paired(pre, post)
plot(pd, type = "profile") + theme_bw()
```

*Running Wilcoxon Test*
```{r}
WT_AB_stress<- wilcox.test(Means ~ release, data = fullbudget_stress, paired = TRUE)
WT_AB_stress
```
RESULTS: There is no significant difference in the troop's mean hourly display of stress behaviors pre- and post-release (V= 57, p=0.8904, n=15).

### Feeding Category
*Setting up Table*
```{r}
pre_fullbudget_feed<- pre_fullbudget %>%
  filter(behavior.category == "Feeding") %>%
  t() %>%
  as.data.frame() %>%
  dplyr::slice(2:16) %>%
  rename(Means = V1) %>%
  mutate(release= "pre")
pre_fullbudget_feed

post_fullbudget_feed<- post_fullbudget %>%
  filter(behavior.category == "Feeding") %>%
  t() %>%
  as.data.frame() %>%
  dplyr::slice(2:16) %>%
  rename(Means = V1) %>%
  mutate(release= "post")
post_fullbudget_feed

fullbudget_feed<- bind_rows(pre_fullbudget_feed, post_fullbudget_feed)
fullbudget_feed$Means <- as.numeric(as.character((fullbudget_feed$Means)))
```

*Creating boxplots and Paired Data Plots*
```{r}
#Finding mean/median
group_by(fullbudget_feed, release) %>%
  summarise(
    count = n(),
    median = median(Means, na.rm = TRUE),
    IQR = IQR(Means, na.rm = TRUE)
  )

ggboxplot(fullbudget_feed, x = "release", y = "Means", 
          color = "release", palette = c("#00AFBB", "#E7B800"),
          order = c("pre", "post"),
          ylab = "Mean Hourly Count", xlab = "Release Stage")

#GGplot2 Plot!
AB_feed_boxplot<- ggplot(fullbudget_feed, aes(x= release, y = Means, fill = release)) +
  geom_boxplot(outlier.color = "black") +
  scale_fill_manual(values = c("mediumpurple3","mediumpurple3")) +
  xlab("Release Stage") +
  ylab("Mean Hourly Count") +
  scale_x_discrete(limits=c("pre", "post")) +
  theme_grey(base_size = 13) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  theme(legend.position = "none")

#Saving the plot
ggsave("Feed Boxplot.pdf", width = 5, height = 4, last_plot())

# Subset weight data before treatment
pre <- subset(fullbudget_feed,  release == "pre", Means,
                 drop = TRUE)
# subset weight data after treatment
post <- subset(fullbudget_feed, release == "post", Means,
                 drop = TRUE)
# Plot paired data
pd <- paired(pre, post)
plot(pd, type = "profile") + theme_bw()
```

*Running Wilcoxon Test*
```{r}
WT_AB_feed<- wilcox.test(Means ~ release, data = fullbudget_feed, paired = TRUE)
WT_AB_feed
```
RESULTS: There is no significant difference in the troop's mean hourly display of feeding behaviors pre- and post-release (V= 80, p=0.2769, n=15).

### Locomote Category
*Setting up Table*
```{r}
pre_fullbudget_loc<- pre_fullbudget %>%
  filter(behavior.category == "Locomote") %>%
  t() %>%
  as.data.frame() %>%
  dplyr::slice(2:16) %>%
  rename(Means = V1) %>%
  mutate(release= "pre")
pre_fullbudget_loc

post_fullbudget_loc<- post_fullbudget %>%
  filter(behavior.category == "Locomote") %>%
  t() %>%
  as.data.frame() %>%
  dplyr::slice(2:16) %>%
  rename(Means = V1) %>%
  mutate(release= "post")
post_fullbudget_loc

fullbudget_loc<- bind_rows(pre_fullbudget_loc, post_fullbudget_loc)
fullbudget_loc$Means <- as.numeric(as.character((fullbudget_loc$Means)))
```

*Creating boxplots and Paired Data Plots*
```{r}
#Finding mean/median
group_by(fullbudget_loc, release) %>%
  summarise(
    count = n(),
    median = median(Means, na.rm = TRUE),
    IQR = IQR(Means, na.rm = TRUE)
  )

ggboxplot(fullbudget_loc, x = "release", y = "Means", 
          color = "release", palette = c("#00AFBB", "#E7B800"),
          order = c("pre", "post"),
          ylab = "Mean Hourly Count", xlab = "Release Stage")

#GGplot2 Plot!
AB_loc_boxplot<- ggplot(fullbudget_loc, aes(x= release, y = Means, fill = release)) +
  geom_boxplot(outlier.color = "black") +
  scale_fill_manual(values = c("lightpink3","lightpink3")) +
  xlab("Release Stage") +
  ylab("Mean Hourly Count") +
  scale_x_discrete(limits=c("pre", "post")) +
  theme_grey(base_size = 13) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  theme(legend.position = "none")

#Saving the plot
ggsave("Move Boxplot.pdf", width = 5, height = 4, last_plot())

# Subset weight data before treatment
pre <- subset(fullbudget_loc,  release == "pre", Means,
                 drop = TRUE)
# subset weight data after treatment
post <- subset(fullbudget_loc, release == "post", Means,
                 drop = TRUE)
# Plot paired data
pd <- paired(pre, post)
plot(pd, type = "profile") + theme_bw()
```

*Running Wilcoxon Test*
```{r}
WT_AB_loc<- wilcox.test(Means ~ release, data = fullbudget_loc, paired = TRUE)
WT_AB_loc

wilcox.test(Means ~ release, data = fullbudget_loc, paired = TRUE,
        alternative = "greater")
```
RESULTS: The troop moved significantly more per hour during the post-release stage (V=120, p=3.052e-05,n=15).

### Other Category
*Setting up Table*
```{r}
pre_fullbudget_other<- pre_fullbudget %>%
  filter(behavior.category == "Other") %>%
  t() %>%
  as.data.frame() %>%
  dplyr::slice(2:16) %>%
  rename(Means = V1) %>%
  mutate(release= "pre")
pre_fullbudget_other

post_fullbudget_other<- post_fullbudget %>%
  filter(behavior.category == "Other") %>%
  t() %>%
  as.data.frame() %>%
  dplyr::slice(2:16) %>%
  rename(Means = V1) %>%
  mutate(release= "post")
post_fullbudget_other

fullbudget_other<- bind_rows(pre_fullbudget_other, post_fullbudget_other)
fullbudget_other$Means <- as.numeric(as.character((fullbudget_other$Means)))
```

*Creating boxplots and Paired Data Plots*
```{r}
#Finding mean/median
group_by(fullbudget_other, release) %>%
  summarise(
    count = n(),
    median = median(Means, na.rm = TRUE),
    IQR = IQR(Means, na.rm = TRUE)
  )

ggboxplot(fullbudget_other, x = "release", y = "Means", 
          color = "release", palette = c("#00AFBB", "#E7B800"),
          order = c("pre", "post"),
          ylab = "Mean Hourly Count", xlab = "Release Stage")

#GGplot2 Plot!
AB_other_boxplot<- ggplot(fullbudget_other, aes(x= release, y = Means, fill = release)) +
  geom_boxplot(outlier.color = "black") +
  scale_fill_manual(values = c("thistle4","thistle4")) +
  xlab("Release Stage") +
  ylab("Mean Hourly Count") +
  scale_x_discrete(limits=c("pre", "post")) +
  theme_grey(base_size = 13) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  theme(legend.position = "none")

#Saving the plot
ggsave("Other Boxplot.pdf", width = 5, height = 4, last_plot())

# Subset weight data before treatment
pre <- subset(fullbudget_loc,  release == "pre", Means,
                 drop = TRUE)
# subset weight data after treatment
post <- subset(fullbudget_loc, release == "post", Means,
                 drop = TRUE)
# Plot paired data
pd <- paired(pre, post)
plot(pd, type = "profile") + theme_bw()
```

*Running Wilcoxon Test*
```{r}
WT_AB_other<- wilcox.test(Means ~ release, data = fullbudget_other, paired = TRUE)
WT_AB_other

wilcox.test(Means ~ release, data = fullbudget_other, paired = TRUE,
        alternative = "greater")
```
RESULTS: The troop's mean hourly count of behavior displays from the other cateogry was significantly higher during the post-release stage (V=103, p=0.006226,n=15).


### Continuous Dataset for Grooming
```{r}
pre_cont_groombudget<- pre_cont %>%
  filter(BEHAVIOUR %in% c("G+","G-"),
         !FOCAL.ID %in% c("ZI","BT")) %>%
  droplevels() %>%
  mutate(behavior.category = as.character("Grooming")) %>%
  rename(day = DAY)

post_cont_groombudget<- post_cont %>%
  filter(BEHAVIOUR %in% c("G+","G-"),
         !FOCAL.ID %in% c("RE","CI","HO","PA")) %>%
  droplevels() %>%
  rename(day = DAY,
         hour = TIME..HOUR.)
```

### Pre-Release
*Mean Grooming Activity Budget Per Hour*
```{r}
#Pops
Pops_budget5<- pre_cont_groombudget %>%
  filter(FOCAL.ID == "PO") %>% #filter out Pops
  group_by(MONTH,day,hour) %>% #group by these columns because I need unique counts PER HOUR
  summarize(count=n()) %>% #counts up all of the times each specific month-day-hour had data (so every time G+ or G- was recorded)
  ungroup()
  
Pops_budget5<- Pops_budget5 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Pops_budget5)))
  
#Blue
Blue_budget5<- pre_cont_groombudget %>%
  filter(FOCAL.ID == "BL") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Blue_budget5<- Blue_budget5 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Blue_budget5)))

#Amy
Amy_budget5<- pre_cont_groombudget %>%
  filter(FOCAL.ID == "AM") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Amy_budget5<- Amy_budget5 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Amy_budget5)))

#Alex
Alex_budget5<- pre_cont_groombudget %>%
  filter(FOCAL.ID == "AL") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Alex_budget5<- Alex_budget5 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Alex_budget5)))

#Boo
Boo_budget5<- pre_cont_groombudget %>%
  filter(FOCAL.ID == "BO") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Boo_budget5<- Boo_budget5 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Boo_budget5)))

#Big Mama
Bgm_budget5<- pre_cont_groombudget %>%
  filter(FOCAL.ID == "BM") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Bgm_budget5<- Bgm_budget5 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Bgm_budget5)))

#Augustine
Aug_budget5<- pre_cont_groombudget %>%
  filter(FOCAL.ID == "AU") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Aug_budget5<- Aug_budget5 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Aug_budget5)))

#Eddy
Ed_budget5<- pre_cont_groombudget %>%
  filter(FOCAL.ID == "ED") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Ed_budget5<- Ed_budget5 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Ed_budget5)))

#Jack
Jack_budget5<- pre_cont_groombudget %>%
  filter(FOCAL.ID == "JA") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Jack_budget5<- Jack_budget5 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Jack_budget5)))

#Tinker
Tink_budget5<- pre_cont_groombudget %>%
  filter(FOCAL.ID == "TI") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Tink_budget5<- Tink_budget5 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Tink_budget5)))

#Kovu
Kovu_budget5<- pre_cont_groombudget %>%
  filter(FOCAL.ID == "KO") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Kovu_budget5<- Kovu_budget5 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Kovu_budget5)))

#Mango
Mango_budget5<- pre_cont_groombudget %>%
  filter(FOCAL.ID == "MG") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Mango_budget5<- Mango_budget5 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Mango_budget5)))

#Neville
Nev_budget5<- pre_cont_groombudget %>%
  filter(FOCAL.ID == "NE") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Nev_budget5<- Nev_budget5 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Nev_budget5)))

#Toni
Toni_budget5<- pre_cont_groombudget %>%
  filter(FOCAL.ID == "TO") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Toni_budget5<- Toni_budget5 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Toni_budget5)))

#May
May_budget5<- pre_cont_groombudget %>%
  filter(FOCAL.ID == "MA") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
May_budget5<- May_budget5 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(May_budget5)))
```

*Pre-release Grooming Table*
```{r}
pre_groombudget_table<- bind_rows(Pops_budget5,Blue_budget5,Amy_budget5,Alex_budget5,Boo_budget5,Bgm_budget5,Aug_budget5,Ed_budget5,Jack_budget5,Tink_budget5,Kovu_budget5,Mango_budget5,May_budget5,Toni_budget5,Nev_budget5) %>%
  mutate(release = "pre")
```

### Post-Release
*Mean Grooming Activity Budget Per Hour*
```{r}
#Pops
Pops_budget6<- post_cont_groombudget %>%
  filter(FOCAL.ID == "PO") %>% #filter out Pops
  group_by(MONTH,day,hour) %>% #group by these columns because I need unique counts PER HOUR
  summarize(count=n()) %>% #counts up all of the times each specific month-day-hour had data (so every time G+ or G- was recorded)
  ungroup()
  
Pops_budget6<- Pops_budget6 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Pops_budget6)))
  
#Blue
Blue_budget6<- post_cont_groombudget %>%
  filter(FOCAL.ID == "BL") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Blue_budget6<- Blue_budget6 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Blue_budget6)))

#Amy
Amy_budget6<- post_cont_groombudget %>%
  filter(FOCAL.ID == "AM") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Amy_budget6<- Amy_budget6 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Amy_budget6)))

#Alex
Alex_budget6<- post_cont_groombudget %>%
  filter(FOCAL.ID == "AL") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Alex_budget6<- Alex_budget6 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Alex_budget6)))

#Boo
Boo_budget6<- post_cont_groombudget %>%
  filter(FOCAL.ID == "BO") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Boo_budget6<- Boo_budget6 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Boo_budget6)))

#Big Mama
Bgm_budget6<- post_cont_groombudget %>%
  filter(FOCAL.ID == "BM") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Bgm_budget6<- Bgm_budget6 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Bgm_budget6)))

#Augustine
Aug_budget6<- post_cont_groombudget %>%
  filter(FOCAL.ID == "AU") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Aug_budget6<- Aug_budget6 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Aug_budget6)))

#Eddy
Ed_budget6<- post_cont_groombudget %>%
  filter(FOCAL.ID == "ED") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Ed_budget6<- Ed_budget6 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Ed_budget6)))

#Jack
Jack_budget6<- post_cont_groombudget %>%
  filter(FOCAL.ID == "JA") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Jack_budget6<- Jack_budget6 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Jack_budget6)))

#Tinker
Tink_budget6<- post_cont_groombudget %>%
  filter(FOCAL.ID == "TI") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Tink_budget6<- Tink_budget6 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Tink_budget6)))

#Kovu
Kovu_budget6<- post_cont_groombudget %>%
  filter(FOCAL.ID == "KO") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Kovu_budget6<- Kovu_budget6 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Kovu_budget6)))

#Mango
Mango_budget6<- post_cont_groombudget %>%
  filter(FOCAL.ID == "MG") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Mango_budget6<- Mango_budget6 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Mango_budget6)))

#Neville
Nev_budget6<- post_cont_groombudget %>%
  filter(FOCAL.ID == "NE") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Nev_budget6<- Nev_budget6 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Nev_budget6)))

#Toni
Toni_budget6<- post_cont_groombudget %>%
  filter(FOCAL.ID == "TO") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
Toni_budget6<- Toni_budget6 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(Toni_budget6)))

#May
May_budget6<- post_cont_groombudget %>%
  filter(FOCAL.ID == "MA") %>% 
  group_by(MONTH,day,hour) %>% 
  summarize(count=n()) %>% 
  ungroup()
  
May_budget6<- May_budget6 %>%
  summarize(total= sum(count)) %>%
  mutate(Mean = (total/nrow(May_budget6)))
```

*Post-release Grooming Table*
```{r}
post_groombudget_table<- bind_rows(Pops_budget6,Blue_budget6,Amy_budget6,Alex_budget6,Boo_budget6,Bgm_budget6,Aug_budget6,Ed_budget6,Jack_budget6,Tink_budget6,Kovu_budget6,Mango_budget6,May_budget6,Toni_budget6,Nev_budget6) %>%
  mutate(release = "post")
post_groombudget_table[9,2]<- as.numeric(0)
post_groombudget_table[15,2]<- as.numeric(0)
```

*Full Grooming Table*
```{r}
full_groombudget_table<- bind_rows(pre_groombudget_table,post_groombudget_table)

#GGplot2 Plot!
AB_groom_boxplot<- ggplot(full_groombudget_table, aes(x= release, y = Mean, fill = release)) +
  geom_boxplot(outlier.color = "black") +
  scale_fill_manual(values = c("tomato3","tomato3")) +
  xlab("Release Stage") +
  ylab("Mean Hourly Count") +
  scale_x_discrete(limits=c("pre", "post")) +
  theme_grey(base_size = 13) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  theme(legend.position = "none")

#Saving the plot
ggsave("Groom Boxplot.pdf", width = 5, height = 4, last_plot())
```

*Running Wilcoxon Test*
```{r}
WT_AB_groom<- wilcox.test(Mean ~ release, data = full_groombudget_table, paired = TRUE)
WT_AB_groom
```
RESULTS: There is no significant difference in the troop's mean hourly grooming counts from the all-occurence continuous dataset pre- and post-release (V= 76, p= 0.1876, n=15). 

### COUNT Activity Budget Tables (to use for LMM)
```{r}
#creating a full activity budget table for all individuals post-release 
post_ABtable_full<- bind_rows(Pops_budget3,Blue_budget3,Amy_budget3) %>% #this data is counts per focal in each focals, NOT mean count across all of the focals
  mutate(release = "2")
post_ABtable_full

#creating a full activity budget table for all individuals pre-release
pre_ABtable_full<- bind_rows(Pops_budget,Blue_budget,Amy_budget) %>% #this data is counts per focal in each focals, NOT mean count across all of the focals
  mutate(release = "1")
pre_ABtable_full

#combining the two together with sex and age
ABtable_full<- bind_rows(pre_ABtable_full,post_ABtable_full) %>%
  mutate(sex = 
           case_when(ID == "PO" ~ as.character("0"), #making these character so that I can make them factors with labels in the next step 
                     ID %in% c("BL","AM")~ as.character("1")),
         age = 
           case_when(ID %in% c("PO","BL","AM")~ as.character("1"))) %>%
  rename(counts = count)

unique(ABtable_full$ID)


#making sure all of my columns are factors 
ABtable_full <- within(ABtable_full, {
  sex <- factor(sex, levels = 0:1, labels = c("M", "F"))
  age <- factor(age, levels = 1, labels = "A")
  release <- factor(release, levels = 1:2, labels = c("pre","post"))
  ID <- factor(ID, levels= c("PO","BL","AM"))
})
str(ABtable_full)
```

*Predator ONLY table*
```{r}
#filtering out the predator category
ABtable_full_pred<- ABtable_full %>%
  filter(behavior.category == "Predator")
ABtable_full_pred

#Checking histogram
hist(log(ABtable_full_pred$count))

pred_lm = lm(count ~ release, data = ABtable_full_pred)
summary(pred_lm)

pred_mixed<- lmer(count ~ release + (1 | ID), data = ABtable_full_pred)
summary(pred_mixed)

confint(pred_mixed)
```

## Kruskal Wallis Test
### Pre-release
```{r}
ABtable_pre<- ABtable_full %>%
  filter(release == "pre", behavior.category != "Human")

group_by(pre_fullbudget_FULL, behavior.category) %>%
  summarise(
    count = n(),
    mean = mean(Mean, na.rm = TRUE),
    sd = sd(Mean, na.rm = TRUE),
    median = median(Mean, na.rm = TRUE),
    IQR = IQR(Mean, na.rm = TRUE)
  )

ggboxplot(pre_fullbudget_FULL, x = "behavior.category", y = "Mean", 
          ylab = "Activity Budget Category", xlab = "Mean Count Per Hour")

#GGplot2 Plot!
AB_pre_boxplot<- ggplot(pre_fullbudget_FULL, aes(x=behavior.category, y=Mean, fill=behavior.category)) +
  geom_boxplot(outlier.color = "black") +
  scale_x_discrete(limits=c("Feeding", "Locomote","Other","Predator","Social","Stress"),name="Behavior Category") +
  ylab("Mean Count Per Hour") +
  theme_grey(base_size = 13) +
  scale_fill_brewer("Accent") +
  theme(legend.position = "none") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), #removing gridlines and background
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  stat_summary(geom = 'text', label = c("a","b","c","d","c","e"), fun = max, vjust = -1, color = "black", size= 4) +
  ylim(0,11)

ggsave("AB Pre Plot.pdf", width = 6, height = 4, last_plot())

##HERE IS THE ACTUAL TEST
kruskal.test(Mean ~ behavior.category, data = pre_fullbudget_FULL)

#Mann-Whitney U Test
ManWhitU_pre<- pairwise.wilcox.test(pre_fullbudget_FULL$Mean, pre_fullbudget_FULL$behavior.category,
                 p.adjust.method = "BH")

library(rcompanion)
library(multcompView)
ManWhitU_pre = ManWhitU_pre$p.value
ManWhitU_pre2 = fullPTable(ManWhitU_pre) #doesn't work?
ManWhitU_pre2

multcompView::multcompLetters(ManWhitU_pre2,
                compare="<",
                threshold=0.05,
                Letters=letters,
                reversed = FALSE) #gives us the letters to put on the boxplot
```

### Post-Release
```{r}
#TO get means and medians
group_by(post_fullbudget_FULL, behavior.category) %>%
  summarise(
    count = n(),
    mean = mean(Mean, na.rm = TRUE),
    sd = sd(Mean, na.rm = TRUE),
    median = median(Mean, na.rm = TRUE),
    IQR = IQR(Mean, na.rm = TRUE)
  )

#Boxplot
#my_comparisons <- list( c("Predator", "Stress"),c("Predator", "Social"),c("Predator", "Feeding"),c("Predator", "Locomote"), c("Predator", "Other"), c("Social", "Stress"), c("Social", "Feeding"),c("Social", "Locomote"),c("Social", "Other"),c("Locomote", "Stress"),c("Other", "Stress"),c("Locomote", "Other") )

AB_post_boxplot<- ggplot(post_fullbudget_FULL, aes(x=behavior.category, y=Mean, fill=behavior.category)) +
  geom_boxplot(outlier.color = "black") +
  scale_x_discrete(limits=c("Feeding", "Locomote","Other","Predator","Social","Stress"),name="Behavior Category") +
  ylab("Mean Count Per Hour") +
  theme_grey(base_size = 13) +
  scale_fill_brewer("Blues") +
  theme(legend.position = "none") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), #removing gridlines and background
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  stat_summary(geom = 'text', label = c("a","b","c","a","c","e"), fun = max, vjust = -1, color = "black", size= 4) +
  ylim(0,11)

ggsave("AB Post Plot.pdf", width = 6, height = 4, last_plot())

kruskal.test(Mean ~ behavior.category, data = post_fullbudget_FULL)
compare_means(Mean ~ behavior.category,  data = post_fullbudget_FULL, method = "kr")

#Mann-Whitney U Test
ManWhitU_post<- pairwise.wilcox.test(post_fullbudget_FULL$Mean, post_fullbudget_FULL$behavior.category,
                 p.adjust.method = "BH")

library(rcompanion)
library(ggsignif)
library(multcompView)
ManWhitU_post = ManWhitU_post$p.value
ManWhitU_post2 = fullPTable(ManWhitU_post)
ManWhitU_post2

multcompLetters(ManWhitU_post2,
                compare="<",
                threshold=0.05,
                Letters=letters,
                reversed = FALSE)
```
RESULTS: There is a significant difference across behavior categories in the troop's activity budget both pre-release (p=2.449e-15) and post-release (p=6.082e-13). The Mann-Whitney U Test shows the troop's average display of predator-releated behaviors per hour are significantly higher than all other behavior categories during pre-release stage with a mean of 9.02 (n=15). The troop's average display of predator-related behaviors and feeding behaviors are significantly higher than all other behavior categories during post-release with means of 6.29 and 5.96, respectively (n=15). The troop's average display of stress-related behaviors is significantly lower than all other behavior categories during pre- and post-release, with means of 1.53 and 1.50, respectively (n=15).

### Kruskal Test for combined AB dataframe
```{r}
group_by(ABtable_full, behavior.category) %>%
  summarise(
    count = n(),
    mean = mean(counts, na.rm = TRUE),
    sd = sd(counts, na.rm = TRUE),
    median = median(counts, na.rm = TRUE),
    IQR = IQR(counts, na.rm = TRUE)
  )

ggboxplot(ABtable_full, x = "behavior.category", y = "counts", 
          ylab = "Activity Budget Category", xlab = "Mean Count Per Focal")

ggline(ABtable_full, x = "behavior.category", y = "counts", 
       add = c("mean_se", "jitter"), 
       ylab = "Activity Budget Category", xlab = "Mean Count Per Focal")

kruskal.test(counts ~ behavior.category, data = ABtable_full)
pairwise.wilcox.test(ABtable_full$counts, ABtable_full$behavior.category,
                 p.adjust.method = "BH")
```
RESULTS: There is a significant difference across behavior categories in the troops activity budget both pre- and post-release. 
